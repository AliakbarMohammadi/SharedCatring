{
  "info": {
    "name": "Catering System API",
    "description": "Enterprise Catering System - سیستم کترینگ سازمانی",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "accessToken", "value": "" },
    { "key": "refreshToken", "value": "" }
  ],
  "item": [
    {
      "name": "API Gateway",
      "description": "تست‌های دروازه API",
      "item": [
        {
          "name": "Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has success true', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "});",
                  "",
                  "pm.test('Service is healthy', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('healthy');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/health",
            "description": "بررسی سلامت سرویس API Gateway"
          }
        },
        {
          "name": "Rate Limiting Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Rate limit headers exist', function () {",
                  "    pm.response.to.have.header('X-RateLimit-Limit');",
                  "    pm.response.to.have.header('X-RateLimit-Remaining');",
                  "});",
                  "",
                  "pm.test('Status code is 200 or 429', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 429]);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/health",
            "description": "تست محدودیت نرخ درخواست"
          }
        },
        {
          "name": "Unauthorized Access Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Error response format is correct', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(false);",
                  "    pm.expect(jsonData.error).to.have.property('code');",
                  "    pm.expect(jsonData.error).to.have.property('message');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/users/me",
            "description": "تست دسترسی بدون توکن"
          }
        },
        {
          "name": "Invalid Token Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Error code is ERR_INVALID_TOKEN', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.error.code).to.eql('ERR_INVALID_TOKEN');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/users/me",
            "header": [
              { "key": "Authorization", "value": "Bearer invalid-token-here" }
            ],
            "description": "تست توکن نامعتبر"
          }
        },
        {
          "name": "Not Found Route Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Error response format is correct', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(false);",
                  "    pm.expect(jsonData.error.code).to.eql('ERR_NOT_FOUND');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/nonexistent-route",
            "description": "تست مسیر ناموجود"
          }
        },
        {
          "name": "Swagger Documentation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is HTML', function () {",
                  "    pm.response.to.have.header('Content-Type');",
                  "    pm.expect(pm.response.headers.get('Content-Type')).to.include('text/html');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api-docs",
            "description": "دسترسی به مستندات Swagger"
          }
        }
      ]
    },
    {
      "name": "Health Checks",
      "description": "بررسی سلامت سرویس‌ها",
      "item": [
        {
          "name": "API Gateway Health",
          "request": { "method": "GET", "url": "{{baseUrl}}/health" }
        },
        {
          "name": "Auth Service Health",
          "request": { "method": "GET", "url": "http://localhost:3001/health" }
        },
        {
          "name": "Identity Service Health",
          "request": { "method": "GET", "url": "http://localhost:3002/health" }
        },
        {
          "name": "User Service Health",
          "request": { "method": "GET", "url": "http://localhost:3003/health" }
        },
        {
          "name": "Company Service Health",
          "request": { "method": "GET", "url": "http://localhost:3004/health" }
        },
        {
          "name": "Menu Service Health",
          "request": { "method": "GET", "url": "http://localhost:3005/health" }
        },
        {
          "name": "Order Service Health",
          "request": { "method": "GET", "url": "http://localhost:3006/health" }
        },
        {
          "name": "Invoice Service Health",
          "request": { "method": "GET", "url": "http://localhost:3007/health" }
        },
        {
          "name": "Payment Service Health",
          "request": { "method": "GET", "url": "http://localhost:3008/health" }
        },
        {
          "name": "Wallet Service Health",
          "request": { "method": "GET", "url": "http://localhost:3009/health" }
        },
        {
          "name": "Notification Service Health",
          "request": { "method": "GET", "url": "http://localhost:3010/health" }
        },
        {
          "name": "Reporting Service Health",
          "request": { "method": "GET", "url": "http://localhost:3011/health" }
        },
        {
          "name": "File Service Health",
          "request": { "method": "GET", "url": "http://localhost:3012/health" }
        }
      ]
    },
    {
      "name": "Authentication",
      "description": "احراز هویت",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201 or 409', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/auth/register",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"Test@123456\",\n  \"firstName\": \"علی\",\n  \"lastName\": \"محمدی\",\n  \"phone\": \"09121234567\"\n}"
            }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.data) {",
                  "    pm.collectionVariables.set('accessToken', jsonData.data.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.data.refreshToken);",
                  "    pm.test('Tokens received', function () {",
                  "        pm.expect(jsonData.data.accessToken).to.be.a('string');",
                  "        pm.expect(jsonData.data.refreshToken).to.be.a('string');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/auth/login",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"identifier\": \"test@example.com\",\n  \"password\": \"Test@123456\"\n}"
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "var jsonData = pm.response.json();",
                  "if (jsonData.success && jsonData.data) {",
                  "    pm.collectionVariables.set('accessToken', jsonData.data.accessToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/auth/refresh-token",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            }
          }
        },
        {
          "name": "Get Current User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User data returned', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.eql(true);",
                  "    pm.expect(jsonData.data).to.have.property('email');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/auth/me",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Forgot Password",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/auth/forgot-password",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n}"
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/auth/logout",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Menu",
      "description": "منو",
      "item": [
        {
          "name": "Get Categories",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/menu/categories"
          }
        },
        {
          "name": "Create Category",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/menu/categories",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"غذاهای ایرانی\",\n  \"nameEn\": \"Iranian Foods\",\n  \"description\": \"انواع غذاهای سنتی ایرانی\"\n}"
            }
          }
        },
        {
          "name": "Get Menu Items",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/menu/items?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "menu", "items"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "10" }
              ]
            }
          }
        },
        {
          "name": "Create Menu Item",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/menu/items",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"چلو کباب کوبیده\",\n  \"nameEn\": \"Chelo Kabab Koobideh\",\n  \"description\": \"کباب کوبیده با برنج ایرانی\",\n  \"categoryId\": \"CATEGORY_ID_HERE\",\n  \"price\": 150000,\n  \"preparationTime\": 30,\n  \"servingSize\": \"۱ پرس\",\n  \"dietary\": [\"halal\"]\n}"
            }
          }
        },
        {
          "name": "Get Daily Menu (Public)",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/menu/daily",
            "description": "دریافت منوی روزانه - بدون نیاز به احراز هویت"
          }
        }
      ]
    },
    {
      "name": "Orders",
      "description": "سفارشات",
      "item": [
        {
          "name": "Create Order",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/orders",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"dailyMenuId\": \"DAILY_MENU_ID\",\n  \"deliveryDate\": \"2024-01-20\",\n  \"mealType\": \"lunch\",\n  \"deliveryLocation\": \"طبقه ۳، اتاق ۳۰۵\",\n  \"items\": [\n    {\n      \"menuItemId\": \"MENU_ITEM_ID\",\n      \"menuItemName\": \"چلو کباب کوبیده\",\n      \"quantity\": 1,\n      \"unitPrice\": 150000\n    }\n  ],\n  \"notes\": \"لطفاً بدون پیاز\"\n}"
            }
          }
        },
        {
          "name": "Get My Orders",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/orders/my-orders",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get Order by ID",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/orders/ORDER_ID",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Cancel Order",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/orders/ORDER_ID/cancel",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"تغییر برنامه\"\n}"
            }
          }
        }
      ]
    },
    {
      "name": "Wallet",
      "description": "کیف پول",
      "item": [
        {
          "name": "Create Wallet",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/wallets",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Get Balance",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/wallets/balance",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Deposit",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/v1/wallets/deposit",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 500000,\n  \"description\": \"شارژ کیف پول\"\n}"
            }
          }
        },
        {
          "name": "Get Transactions",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/wallets/transactions",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        }
      ]
    },
    {
      "name": "Reports",
      "description": "گزارشات",
      "item": [
        {
          "name": "Dashboard Stats",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/reports/dashboard",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Order Reports",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/api/v1/reports/orders?startDate=2024-01-01&endDate=2024-01-31",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "reports", "orders"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-01-31" }
              ]
            },
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        },
        {
          "name": "Menu Popularity",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/v1/reports/menu-popularity",
            "header": [{ "key": "Authorization", "value": "Bearer {{accessToken}}" }]
          }
        }
      ]
    }
  ]
}
